{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - NokshiBox{% endblock %}

{% block content %}
<div class="min-h-screen relative px-6 py-12"
     style="background-image: url('{% static 'image/pro.png' %}'); background-size: cover; background-position: center; background-attachment: fixed;">

  <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-10 justify-center">

    <!-- Profile Card -->
    <div
      class="{% if user_profile.role == 'seller' %}w-96 md:w-1/3{% else %}w-full md:w-2/3{% endif %} bg-[#F0EAD6]/70 rounded-2xl shadow-lg border-4 border-[#a9745b] p-6 text-center md:text-left flex flex-col {% if user_profile.role != 'seller' %}md:flex-row items-center md:items-start{% endif %}">
      
      {% if user_profile.photo %}
        <img src="{{ user_profile.photo.url }}" alt="{{ user_profile.full_name }}"
            class="w-45 h-45 rounded-full border-4 border-[#b5835a] object-cover {% if user_profile.role != 'seller' %}md:mr-6 mx-auto md:mx-0 mb-4 md:mb-0{% else %}mx-auto mb-4{% endif %}">
      {% else %}
        <div class="w-45 h-45 rounded-full bg-[#a9745b] flex items-center justify-center text-[#fff2d1] text-4xl font-bold {% if user_profile.role != 'seller' %}md:mr-6 mx-auto md:mx-0 mb-4 md:mb-0{% else %}mx-auto mb-4{% endif %}">
          {{ user_profile.full_name|slice:":1" }}
        </div>
      {% endif %}


      <!-- User Info -->
      <div>
        <h2 class="text-2xl font-extrabold text-[#3b2f2f] mb-2">{{ user_profile.full_name }}</h2>

        <!-- Contact Info -->
        <p class="text-[#4B3621]">
          <i class="fa-solid fa-envelope mr-2"></i>{{ user_profile.email }}
        </p>
        <p class="text-[#4B3621]">
          <i class="fa-solid fa-phone mr-2"></i>{{ user_profile.mobile_no }}
        </p>

        {% if user_profile.facebook_link %}
          <p class="mt-2">
            <a href="{{ user_profile.facebook_link }}" target="_blank" class="text-[#3b2f2f] hover:text-[#a9745b]">
              <i class="fab fa-facebook mr-2"></i>Facebook Page
            </a>
          </p>
        {% endif %}

        <!-- Request for Customization -->
        {% if not is_owner and user_profile.role == 'seller' %}
          <div class="mt-4">
            <button id="requestBtn"
              class="flex-1 text-center bg-[#d9b08c] text-[#3b2f2f] font-semibold px-6 py-3 rounded-lg hover:bg-[#b5835a] hover:text-white transition duration-300 shadow-md">
              Request for Customization
            </button>

            <!-- Hidden Text Box -->
            <div id="requestBox" class="hidden mt-4 bg-[#F0EAD6]/70 border border-[#b5835a]/50 rounded-lg p-4">
              <textarea id="customMessage" rows="4" placeholder="Describe your customization request..."
                class="w-full p-2 border border-[#a9745b]/40 rounded-md focus:outline-none focus:ring-2 focus:ring-[#b5835a] bg-[#fff9ee] text-[#3b2f2f]"></textarea>
              <div class="flex justify-end gap-3 mt-3">
                <button id="sendBtn"
                  class="flex-1 text-center bg-[#d9b08c] text-[#3b2f2f] font-semibold px-6 py-3 rounded-lg hover:bg-[#b5835a] hover:text-white transition duration-300 shadow-md">
                  Send
                </button>
                <button id="closeBtn"
                  class="bg-[#d9c6a5] text-[#3b2f2f] px-4 py-1.5 rounded-lg font-semibold hover:bg-[#c4a982] transition duration-300 shadow-md">
                  Close
                </button>
              </div>
            </div>
          </div>

          <script>
            const requestBtn = document.getElementById('requestBtn');
            const requestBox = document.getElementById('requestBox');
            const closeBtn = document.getElementById('closeBtn');
            const sendBtn = document.getElementById('sendBtn');
            const messageInput = document.getElementById('customMessage');

            requestBtn.addEventListener('click', () => {
              requestBox.classList.toggle('hidden');
            });

            closeBtn.addEventListener('click', () => {
              requestBox.classList.add('hidden');
            });

            sendBtn.addEventListener('click', () => {
              const message = encodeURIComponent(messageInput.value.trim());
              if (message) {
                const email = "{{ user_profile.email }}";
                window.location.href = `mailto:${email}?subject=Customization%20Request&body=${message}`;
                requestBox.classList.add('hidden');
                messageInput.value = '';
              } else {
                alert("Please enter a message before sending.");
              }
            });
          </script>
          {% endif %}

        {% if is_owner %}
          <a id="EditProfile" href="{% url 'edit_profile' user_profile.pk %}"
            class="mt-5 inline-block bg-gradient-to-r from-[#c49a6c] to-[#b5835a] text-[#3b2f2f] px-5 py-2 rounded-lg font-semibold hover:bg-[#b5835a] hover:text-white transition duration-300 shadow-md">
            Edit Profile
          </a>
        {% endif %}

        <div class="mt-6 border-t border-[#b5835a]/40 pt-4 text-[#4B3621]">
          <p><strong>Role:</strong> {{ user_profile.role|title }}</p>
          {% if user_profile.role == 'seller' %}
            <p><strong>Products:</strong> {{ products|length }}</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Right Section -->
    {% if user_profile.role == 'seller' %}
    <div class="w-full md:w-2/3">
        <h2 class="text-2xl font-extrabold text-[#3b2f2f] border-b-2 border-[#b5835a] pb-2 mb-6">
          Products
        </h2>

        {% if products %}
          <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for product in products %}
              <div class="product-card bg-[#F0EAD6]/90 rounded-xl shadow-lg hover:scale-[1.03] transition transform border border-[#a9745b]/50 overflow-hidden">
                <img src="{{ product.image.url }}" alt="{{ product.title }}" class="w-full h-48 object-cover">
                <div class="p-4 text-center">
                  <h3 class="text-lg font-bold text-[#3b2f2f] mb-1 truncate">{{ product.title }}</h3>
                  <p class="text-[#4B3621] text-sm mb-2 truncate">{{ product.details|truncatechars:70 }}</p>
                  <p class="text-[#3b2f2f] font-semibold mb-3">TK {{ product.price }}</p>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-center text-[#4B3621] mt-8">You haven't added any products yet.</p>
        {% endif %}
    </div>
    {% endif %}
  </div>
</div>

<!-- Scroll to Top Button -->
<button id="scrollTop" class="fixed bottom-5 right-5 bg-[#a9745b] text-white rounded-full w-12 h-12 flex items-center justify-center text-xl shadow-md hover:bg-[#8b5e3b] transition hidden">
  <i class="fa-solid fa-arrow-up"></i>
</button>

<!-- JS -->
<script>
  // Scroll to Top
  const scrollBtn = document.getElementById('scrollTop');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      scrollBtn.classList.remove('hidden');
    } else {
      scrollBtn.classList.add('hidden');
    }
  });
  scrollBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
</script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

{% endblock %}
